<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <style>
            #answer {
                font-size: 25px;
            }
        </style>
    </head>
    <body>
        <p id="answer"></p>

        <script type="module">
            import FileReader from '../FileReader.js';
            import Parser from './Parser.js';

            const fileReader = new FileReader('./data.txt', new Parser());
            await fileReader.read();

            const heightMapLines = fileReader.parse();
            const linesAmount = heightMapLines.length;
            const lineLength = heightMapLines[0].length;

            /**
             * Finds adjacent values of a location
             * @param {number} x The X coordinate in the heightMap
             * @param {number} y The Y coordinate in the heightMap
             * @param {boolean} sorted Whether to return sorted (ascending)
             * @returns {array}
             */
            function getAdjacentValues(x, y, sorted) {
                sorted = (sorted === undefined) ? true : false;

                // Value is null if there is no adjacent location at the coordinate
                const values = [
                    // Up
                    (y > 0)
                        ? parseInt(heightMapLines[y - 1][x], 10)
                        : null,
                    // Down
                    (y < linesAmount - 1)
                        ? parseInt(heightMapLines[y + 1][x], 10)
                        : null,
                    // Left
                    (x > 0)
                        ? parseInt(heightMapLines[y][x - 1], 10)
                        : null,
                    // Right
                    (x < lineLength - 1)
                        ? parseInt(heightMapLines[y][x + 1], 10)
                        : null,
                ].filter(value => value !== null);

                return (sorted) ? values.sort() : values;
            }

            const lowestPoints = [];

            // Loop over all X,Y coordinates
            for (let y = 0; y < linesAmount; y++) {
                for (let x = 0; x < lineLength; x++) {
                    const current = parseInt(heightMapLines[y][x], 10);
                    
                    // A 9 can never be the lowest point
                    if (current === 9) {
                        continue;
                    }

                    const adjacentValues = getAdjacentValues(x, y);
                    if (current < adjacentValues[0]) {
                        lowestPoints.push(current);
                    }
                }
            }

            answer.innerText = lowestPoints.reduce((sum, current) => sum + current + 1, 0);
        </script>
    </body>
</html>
