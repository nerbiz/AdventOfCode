<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <style>
            #answer {
                font-size: 25px;
            }
        </style>
    </head>
    <body>
        <p id="answer"></p>

        <script type="module">
            import FileReader from '../FileReader.js';
            import Parser from './Parser.js';
            import Utilities from '../Utilities.js';

            const fileReader = new FileReader('./datatest.txt', new Parser(), false);
            const scanners = await fileReader.parse();

            console.log(scanners);

            // Calculate the distances between beacons
            scanners.forEach(scanner => {
                scanner.beacons.forEach(beacon => {
                    scanner.beacons
                        // Don't check the current beacon itself
                        .filter(otherBeacon => otherBeacon !== beacon)
                        // Calculate the distances using the Pythagoras theorem
                        .forEach(otherBeacon => {
                            beacon.distances.push({
                                from: beacon,
                                to: otherBeacon,
                                distance: Math.sqrt(
                                    Math.abs(otherBeacon.coordinates[0] - beacon.coordinates[0]) ** 2
                                    + Math.abs(otherBeacon.coordinates[1] - beacon.coordinates[1]) ** 2
                                    + Math.abs(otherBeacon.coordinates[2] - beacon.coordinates[2]) ** 2
                                ),
                            });
                        });
                });
            });




            const getBeaconDistances = beacon => beacon.distances
                .map(distance => distance.distance)
                .sort((a, b) => a - b);



            /* Overlapping beacons, according to example */
            const coordsA = [
                '-618,-824,-621',
                '-537,-823,-458',
                '-447,-329,318',
                '404,-588,-901',
                '544,-627,-890',
                '528,-643,409',
                '-661,-816,-575',
                '390,-675,-793',
                '423,-701,434',
                '-345,-311,381',
                '459,-707,401',
                '-485,-357,347',
            ];

            const coordsB = [
                '686,422,578',
                '605,423,415',
                '515,917,-361',
                '-336,658,858',
                '-476,619,847',
                '-460,603,-452',
                '729,430,532',
                '-322,571,750',
                '-355,545,-477',
                '413,935,-424',
                '-391,539,-444',
                '553,889,-390',
            ];

            coordsA.forEach((coords, index) => {
                console.log('-'.repeat(50));
                const beaconA = scanners[0].beacons
                    .filter(beacon => beacon.coordinates.join(',') === coords)
                    .at(0);
                const aDistances = getBeaconDistances(beaconA);

                const beaconB = scanners[1].beacons
                    .filter(beacon => beacon.coordinates.join(',') === coordsB[index])
                    .at(0);
                const bDistances = getBeaconDistances(beaconB);

                const same = aDistances.filter(distance => bDistances.includes(distance));

                // Test result: the overlapping beacons all have 11 same distances to other beacons
                console.log(beaconA, beaconB, 'Same distances', /* aDistances, bDistances, */ same);
            });





            /* // Find the scanners that detect the beacons that have the same distances
            scanners.forEach(scanner => {
                scanners.filter(otherScanner => otherScanner !== scanner)
                    .forEach(otherScanner => {
                        const sameDistances = otherScanner.allDistances
                            .filter(distance => scanner.allDistances.includes(distance));
                        console.log(sameDistances);
                        throw new Error('Done');
                        if (sameDistances.length >= 12) {
                            console.log('Scanner', scanner.index, 'and', otherScanner.index, sameDistances);
                        }
                    });
                throw new Error('Done');
            }); */
        </script>
    </body>
</html>
