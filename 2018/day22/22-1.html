<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Advent of Code</title>
        <style>
            #answer {
                font-size: 25px;
            }
        </style>
    </head>
    <body>
        <p id="answer"></p>

        <script type="module">
            import FileReader from '../../FileReader.js';
            import Parser from './Parser.js';
            import Array2d from '../../Array2d.js';

            const fileReader = new FileReader('./data.txt', new Parser());
            const {depth, target} = await fileReader.parse();
            const cave = new Array2d(target[1] + 1, target[0] + 1);

            cave.forEach2d((region, x, y) => {
                // Determine the geologic index of the region
                if (x === 0 && y === 0 || x === target[0] && y === target[1]) {
                    region.geologicIndex = 0;
                } else if (y === 0) {
                    region.geologicIndex = x * 16807;
                } else if (x === 0) {
                    region.geologicIndex = y * 48271;
                } else {
                    const regionLeft = cave.getItem(x - 1, y);
                    const regionUp = cave.getItem(x, y - 1);
                    region.geologicIndex = regionLeft.erosionLevel * regionUp.erosionLevel;
                }

                // Determine the erosion level and type of the region
                region.erosionLevel = (region.geologicIndex + depth) % 20183;
                region.type = region.erosionLevel % 3;
            });

            document.querySelector('#answer').innerText = cave
                .flat()
                .reduce((sum, region) => (sum + region.type), 0);
        </script>
    </body>
</html>
