<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <style>
            #answer {
                font-size: 25px;
            }
        </style>
    </head>
    <body>
        <p id="answer"></p>

        <script type="module">
            import FileReader from '../../FileReader.js';
            import Parser from './Parser.js';
            import Array2d, {Pathfinding} from '../../Array2d.js';

            const fileReader = new FileReader('./data.txt', new Parser());
            const {number, target} = await fileReader.parse();
            const valueFormula = (x, y) => {
                const decimal = (x * x) + (3 * x) + (2 * x * y) + y + (y * y) + number;
                const binary = decimal.toString(2);
                // True = open space, false = wall
                return (binary.split('').filter(bit => bit === '1').length % 2 === 0);
            };
            const maze = Array2d.withData({
                value: (x, y) => valueFormula(x, y),
            }, target[1] * 2, target[0] * 2);

            // Find the shortest path
            const startNode = maze.getItem(1, 1);
            const endNode = maze.getItem(target[0], target[1]);
            const path = Pathfinding.aStar(maze, startNode, endNode, () => false);

            // Visualize the path
            console.log(maze.toString(node => {
                if (node === startNode || path.includes(node)) {
                    return 'â–ˆ';
                }

                return node.value ? '.' : '#';
            }));

            document.querySelector('#answer').innerText = path.length;
        </script>
    </body>
</html>
