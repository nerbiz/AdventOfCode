<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Advent of Code</title>
        <link rel="stylesheet" href="../../style.css">
    </head>
    <body>
        <p class="answer"></p>

        <script type="module">
            import FileReader from '../../classes/FileReader.js';
            import Parser from './Parser.js';
            import IntcodeComputer from '../IntcodeComputer.js';

            const fileReader = new FileReader('./data.txt', new Parser());
            const program = await fileReader.parse();
            const intcodeComputer = new IntcodeComputer(program);
            intcodeComputer.enableWaiting();

            // Get all signals up to the input prompt
            while (intcodeComputer.getNextSignal() !== undefined) {}

            const inputs = [
                // Jump if C is a gap and D is ground
                'NOT C J',
                'AND D J',
                // Or jump if A is a gap
                'NOT A T',
                'OR T J',
                'WALK',
            ];

            let signal;
            let lastSignal;
            while (inputs.length > 0) {
                const input = inputs.shift()
                    .split('')
                    .concat('\n')
                    .map(character => character.charCodeAt(0));

                intcodeComputer.setInput(...input);

                while ((signal = intcodeComputer.getNextSignal()) !== undefined) {
                    lastSignal = signal;
                }
            }

            document.querySelector('.answer').innerText = lastSignal;
        </script>
    </body>
</html>
